<h1>Follower UI</h1>
<video id="selfcam" autoplay></video>
<pre id="log">
</pre>
<script>
// Listen to window.base_url + /ws/
window.base_url_http = location.protocol+'//'+location.hostname+(location.port ? ':'+location.port: '');
if (location.protocol.indexOf('https') >= 0) {
  window.base_url_ws = 'wss://'+location.hostname+(location.port ? ':'+location.port: '')+'/ws';
}
else {
  window.base_url_ws = 'ws://'+location.hostname+(location.port ? ':'+location.port: '')+'/ws';
}

window.log_e = document.getElementById('log');
window.selfcam_e = document.getElementById('selfcam');

window.ws = new WebSocket(window.base_url_ws);

window.ws.onopen = function (event) {
  var name = localStorage.getItem('name');
  if (!name) {
    name = window.prompt('What is your name?', 'idk man');
    localStorage.setItem('name', name);
  }

  // Tell the server who we are
  window.ws.send(JSON.stringify({
    'event': 'follower-joined',
    'name': name
  }));

};

window.ws.onmessage = function (event) {
  console.log(event.data);
  window.log_e.innerHTML += event.data+'\n';
};

// Begin asking for video
navigator.mediaDevices.getUserMedia({video: true, audio: true}).
  then((stream) => {window.selfcam_e.srcObject = stream});

</script>

